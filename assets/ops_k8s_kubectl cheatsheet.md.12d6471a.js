import{_ as s,o as a,c as n,S as l}from"./chunks/framework.1603d207.js";const E=JSON.parse('{"title":"kubectl备忘单","description":"","frontmatter":{"title":"kubectl备忘单"},"headers":[],"relativePath":"ops/k8s/kubectl cheatsheet.md","filePath":"ops/k8s/kubectl cheatsheet.md","lastUpdated":1691998596000}'),o={name:"ops/k8s/kubectl cheatsheet.md"},p=l(`<blockquote><p>记录一下 kubectl 常见的命令以及操作。</p><p>参考<a href="https://kubernetes.io/zh/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noreferrer">kubectl 备忘单 | Kubernetes</a>，只记录经常使用的。</p><p><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" target="_blank" rel="noreferrer">Kubectl Reference Docs (kubernetes.io)</a></p></blockquote><h2 id="资源类型" tabindex="-1">资源类型 <a class="header-anchor" href="#资源类型" aria-label="Permalink to &quot;资源类型&quot;">​</a></h2><p>不是很清楚的资源先查一下</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--namespaced=true</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;"># 所有命名空间作用域的资源</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--namespaced=false</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 所有非命名空间作用域的资源</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">name</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># 用简单格式列举所有资源（仅显示资源名称）</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wide</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># 用扩展格式列举所有资源（又称 &quot;wide&quot; 格式）</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--verbs=list,get</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;"># 支持 &quot;list&quot; 和 &quot;get&quot; 请求动词的所有资源</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--api-group=extensions</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># &quot;extensions&quot; API 组中的所有资源</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">explain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;">												 </span><span style="color:#676E95;font-style:italic;"># 查看资源定义，以及文档</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">explain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods.spec.containers</span></span></code></pre></div><h2 id="格式化输出" tabindex="-1">格式化输出 <a class="header-anchor" href="#格式化输出" aria-label="Permalink to &quot;格式化输出&quot;">​</a></h2><p>要以特定格式将详细信息输出到终端窗口，将 <code>-o</code>（或者 <code>--output</code>）参数添加到支持的 <code>kubectl</code> 命令中。</p><table><thead><tr><th>输出格式</th><th>描述</th></tr></thead><tbody><tr><td><code>-o=custom-columns=&lt;spec&gt;</code></td><td>使用逗号分隔的自定义列来打印表格</td></tr><tr><td><code>-o=custom-columns-file=&lt;filename&gt;</code></td><td>使用 <code>&lt;filename&gt;</code> 文件中的自定义列模板打印表格</td></tr><tr><td><code>-o=json</code></td><td>输出 JSON 格式的 API 对象</td></tr><tr><td><code>-o=jsonpath=&lt;template&gt;</code></td><td>打印 <a href="https://kubernetes.io/zh/docs/reference/kubectl/jsonpath" target="_blank" rel="noreferrer">jsonpath</a> 表达式中定义的字段</td></tr><tr><td><code>-o=jsonpath-file=&lt;filename&gt;</code></td><td>打印在 <code>&lt;filename&gt;</code> 文件中定义的 <a href="https://kubernetes.io/zh/docs/reference/kubectl/jsonpath" target="_blank" rel="noreferrer">jsonpath</a> 表达式所指定的字段。</td></tr><tr><td><code>-o=name</code></td><td>仅打印资源名称而不打印其他内容</td></tr><tr><td><code>-o=wide</code></td><td>以纯文本格式输出额外信息，对于 Pod 来说，输出中包含了节点名称</td></tr><tr><td><code>-o=yaml</code></td><td>输出 YAML 格式的 API 对象</td></tr></tbody></table><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 自定义列</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">pod-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">custom-columns=NAME:.metadata.name,RSRC:.metadata.resourceVersion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查询并排序</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> [command] </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">TYPE</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">NAME</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> --sort-by=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">jsonpath_exp</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sort-by=.metadata.name</span></span></code></pre></div><h2 id="命名空间" tabindex="-1">命名空间 <a class="header-anchor" href="#命名空间" aria-label="Permalink to &quot;命名空间&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 创建命名空间</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl create namespace test-env </span></span>
<span class="line"><span style="color:#A6ACCD;"># 设置默认命名空间</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl config set-context default --namespace=\${work_namespace}</span></span></code></pre></div><h2 id="创建对象" tabindex="-1">创建对象 <a class="header-anchor" href="#创建对象" aria-label="Permalink to &quot;创建对象&quot;">​</a></h2><p>Kubernetes 配置可以用 YAML 或 JSON 定义。可以使用的文件扩展名有 <code>.yaml</code>、<code>.yml</code> 和 <code>.json</code>。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./my-manifest.yaml</span><span style="color:#A6ACCD;">           </span><span style="color:#676E95;font-style:italic;"># 创建资源</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./my1.yaml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./my2.yaml</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 使用多个文件创建</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./dir</span><span style="color:#A6ACCD;">                        </span><span style="color:#676E95;font-style:italic;"># 基于目录下的所有清单文件创建资源</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://git.io/vPieo</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># 从 URL 中创建资源</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建一个打印 “Hello World” 的 Job</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">job</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hello</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--image=busybox</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello World</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建一个打印 “Hello World” 间隔1分钟的 CronJob</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cronjob</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hello</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--image=busybox</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">--schedule=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*/1 * * * *</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello World</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">explain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;">                          </span><span style="color:#676E95;font-style:italic;"># 获取 pod 清单的文档说明</span></span></code></pre></div><h2 id="查看和查找资源" tabindex="-1">查看和查找资源 <a class="header-anchor" href="#查看和查找资源" aria-label="Permalink to &quot;查看和查找资源&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;"># get 命令的基本输出</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">services</span><span style="color:#A6ACCD;">                          </span><span style="color:#676E95;font-style:italic;"># 列出当前命名空间下的所有 services</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--all-namespaces</span><span style="color:#A6ACCD;">             </span><span style="color:#676E95;font-style:italic;"># 列出所有命名空间下的全部的 Pods</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wide</span><span style="color:#A6ACCD;">                      </span><span style="color:#676E95;font-style:italic;"># 列出当前命名空间下的全部 Pods，并显示更详细的信息</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-dep</span><span style="color:#A6ACCD;">                 </span><span style="color:#676E95;font-style:italic;"># 列出某个特定的 Deployment</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;">                              </span><span style="color:#676E95;font-style:italic;"># 列出当前命名空间下的全部 Pods</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yaml</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># 获取一个 pod 的 YAML</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># describe 命令的详细输出</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">describe</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-node</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">describe</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 列出当前名字空间下所有 Services，按名称排序</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">services</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sort-by=.metadata.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 列出 Pods，按重启次数排序</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sort-by=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.status.containerStatuses[0].restartCount</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 列举所有 PV 持久卷，按容量排序</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sort-by=.spec.capacity.storage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 获取包含 app=cassandra 标签的所有 Pods 的 version 标签</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--selector=app=cassandra</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">jsonpath=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{.items[*].metadata.labels.version}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 检索带有 “.” 键值，例： &#39;ca.crt&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configmap</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myconfig</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jsonpath=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{.data.ca\\.crt}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 获取所有工作节点（使用选择器以排除标签名称为 &#39;node-role.kubernetes.io/master&#39; 的结果）</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--selector=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">!node-role.kubernetes.io/master</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 获取当前命名空间中正在运行的 Pods</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--field-selector=status.phase=Running</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 获取全部节点的 ExternalIP 地址</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jsonpath=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{.items[*].status.addresses[?(@.type==&quot;ExternalIP&quot;)].address}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 显示所有 Pods 的标签（或任何其他支持标签的 Kubernetes 对象）</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--show-labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 检查哪些节点处于就绪状态</span></span>
<span class="line"><span style="color:#A6ACCD;">JSONPATH</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jsonpath=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$JSONPATH</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Ready=True</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 不使用外部工具来输出解码后的 Secret</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">secret</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-secret</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">go-template=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{{range $k,$v := .data}}{{&quot;### &quot;}}{{$k}}{{&quot;\\n&quot;}}{{$v|base64decode}}{{&quot;\\n\\n&quot;}}{{end}}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 列出被一个 Pod 使用的全部 Secret</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">jq</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sort</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">uniq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 列举所有 Pods 中初始化容器的容器 ID（containerID）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 可用于在清理已停止的容器时避免删除初始化容器</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--all-namespaces</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jsonpath=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{range .items[*].status.initContainerStatuses[*]}{.containerID}{&quot;\\n&quot;}{end}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">cut</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 列出事件（Events），按时间戳排序</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">events</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sort-by=.metadata.creationTimestamp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 比较当前的集群状态和假定某清单被应用之后的集群状态</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">diff</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./my-manifest.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 生成一个句点分隔的树，其中包含为节点返回的所有键</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 在复杂的嵌套JSON结构中定位键时非常有用</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">jq</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path(..)|[.[]|tostring]|join(&quot;.&quot;)</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 生成一个句点分隔的树，其中包含为pod等返回的所有键</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">jq</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path(..)|[.[]|tostring]|join(&quot;.&quot;)</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><h2 id="更新资源" tabindex="-1">更新资源 <a class="header-anchor" href="#更新资源" aria-label="Permalink to &quot;更新资源&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 升级</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollout</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment/frontend</span><span style="color:#A6ACCD;">                      </span><span style="color:#676E95;font-style:italic;"># 检查 Deployment 的历史记录，包括版本</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollout</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment/frontend</span><span style="color:#A6ACCD;">                         </span><span style="color:#676E95;font-style:italic;"># 回滚到上次部署版本</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollout</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment/frontend</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--to-revision=2</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># 回滚到特定部署版本</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollout</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-w</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment/frontend</span><span style="color:#A6ACCD;">                    </span><span style="color:#676E95;font-style:italic;"># 监视 &quot;frontend&quot; Deployment 的滚动升级状态直到完成</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollout</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment/frontend</span><span style="color:#A6ACCD;">                      </span><span style="color:#676E95;font-style:italic;"># 轮替重启 &quot;frontend&quot; Deployment</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 强制替换，删除后重建资源。会导致服务不可用。</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">replace</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--force</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./pod.json</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">label</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">new-label=awesome</span><span style="color:#A6ACCD;">                      </span><span style="color:#676E95;font-style:italic;"># 添加标签</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">annotate</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">icon-url=http://goo.gl/XXBTWq</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;"># 添加注解</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">autoscale</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">foo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--min=2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--max=10</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># 对 &quot;foo&quot; Deployment 自动伸缩容</span></span></code></pre></div><h2 id="对资源进行伸缩" tabindex="-1">对资源进行伸缩 <a class="header-anchor" href="#对资源进行伸缩" aria-label="Permalink to &quot;对资源进行伸缩&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--replicas=3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rs/foo</span><span style="color:#A6ACCD;">                                 </span><span style="color:#676E95;font-style:italic;"># 将名为 &#39;foo&#39; 的副本集伸缩到 3 副本</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--replicas=3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">foo.yaml</span><span style="color:#A6ACCD;">                            </span><span style="color:#676E95;font-style:italic;"># 将在 &quot;foo.yaml&quot; 中的特定资源伸缩到 3 个副本</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--current-replicas=2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--replicas=3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deployment/mysql</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 如果名为 mysql 的 Deployment 的副本当前是 2，那么将它伸缩到 3</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--replicas=5</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rc/foo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rc/bar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rc/baz</span><span style="color:#A6ACCD;">                   </span><span style="color:#676E95;font-style:italic;"># 伸缩多个副本控制器</span></span></code></pre></div><h2 id="删除资源" tabindex="-1">删除资源 <a class="header-anchor" href="#删除资源" aria-label="Permalink to &quot;删除资源&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./pod.json</span><span style="color:#A6ACCD;">                                 </span><span style="color:#676E95;font-style:italic;"># 删除在 pod.json 中指定的类型和名称的 Pod</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod,service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">baz</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">foo</span><span style="color:#A6ACCD;">                           </span><span style="color:#676E95;font-style:italic;"># 删除名称为 &quot;baz&quot; 和 &quot;foo&quot; 的 Pod 和服务</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods,services</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-l</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">name=myLabel</span><span style="color:#A6ACCD;">                 </span><span style="color:#676E95;font-style:italic;"># 删除包含 name=myLabel 标签的 pods 和服务</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-n</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-ns</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod,svc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--all</span><span style="color:#A6ACCD;">                        </span><span style="color:#676E95;font-style:italic;"># 删除在 my-ns 名字空间中全部的 Pods 和服务</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 删除所有与 pattern1 或 pattern2 awk 模式匹配的 Pods</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pods</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-n</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mynamespace</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--no-headers=true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">awk</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/pattern1|pattern2/{print $1}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">xargs</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-n</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mynamespace</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod</span></span></code></pre></div><h2 id="查看日志" tabindex="-1">查看日志 <a class="header-anchor" href="#查看日志" aria-label="Permalink to &quot;查看日志&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">kubectl logs my-pod                                 # 获取 pod 日志（标准输出）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs -l name=myLabel                        # 获取含 name=myLabel 标签的 Pods 的日志（标准输出）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs my-pod --previous                      # 获取上个容器实例的 pod 日志（标准输出）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs my-pod -c my-container                 # 获取 Pod 容器的日志（标准输出, 多容器场景）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs -l name=myLabel -c my-container        # 获取含 name=myLabel 标签的 Pod 容器日志（标准输出, 多容器场景）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs my-pod -c my-container --previous      # 获取 Pod 中某容器的上个实例的日志（标准输出, 多容器场景）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs -f my-pod                              # 流式输出 Pod 的日志（标准输出）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs -f my-pod -c my-container              # 流式输出 Pod 容器的日志（标准输出, 多容器场景）</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl logs -f -l name=myLabel --all-containers    # 流式输出含 name=myLabel 标签的 Pod 的所有日志（标准输出）</span></span></code></pre></div><h2 id="与运行中的-pods-进行交互" tabindex="-1">与运行中的 Pods 进行交互 <a class="header-anchor" href="#与运行中的-pods-进行交互" aria-label="Permalink to &quot;与运行中的 Pods 进行交互&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">attach</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;">                            </span><span style="color:#676E95;font-style:italic;"># 挂接到一个运行的容器中</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">port-forward</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#C3E88D;">:6000</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;font-style:italic;"># 在本地计算机上侦听端口 5000 并转发到 my-pod 上的端口 6000</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ls</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;">                         </span><span style="color:#676E95;font-style:italic;"># 在已有的 Pod 中运行命令（单容器场景）</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--stdin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--tty</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/sh</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 使用交互 shell 访问正在运行的 Pod (一个容器场景)</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ls</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># 在已有的 Pod 中运行命令（多容器场景）</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">top</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">POD_NAME</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--containers</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;font-style:italic;"># 显示给定 Pod 和其中容器的监控数据</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">top</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">POD_NAME</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sort-by=cpu</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;font-style:italic;"># 显示给定 Pod 的指标并且按照 &#39;cpu&#39; 或者 &#39;memory&#39; 排序</span></span></code></pre></div><h2 id="节点和集群" tabindex="-1">节点和集群 <a class="header-anchor" href="#节点和集群" aria-label="Permalink to &quot;节点和集群&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">kubectl cordon my-node                               # 标记 my-node 节点为不可调度</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl drain my-node                                # 对 my-node 节点进行清空操作，为节点维护做准备</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl uncordon my-node                             # 标记 my-node 节点为可以调度</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl top node my-node                             # 显示给定节点的度量值</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl cluster-info                                 # 显示主控节点和服务的地址</span></span></code></pre></div>`,27),e=[p];function t(c,r,C,y,D,A){return a(),n("div",null,e)}const d=s(o,[["render",t]]);export{E as __pageData,d as default};
