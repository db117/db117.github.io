import{_ as a,c as n,a3 as p,o as i}from"./chunks/framework.B112ehe2.js";const k=JSON.parse('{"title":"supervisord使用","description":"","frontmatter":{"title":"supervisord使用"},"headers":[],"relativePath":"ops/supervisord.md","filePath":"ops/supervisord.md"}'),e={name:"ops/supervisord.md"};function l(t,s,o,r,c,h){return i(),n("div",null,s[0]||(s[0]=[p(`<h3 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h3><p><a href="https://github.com/Supervisor/supervisor" target="_blank" rel="noreferrer">GitHub</a></p><p><a href="https://pypi.org/project/supervisor/" target="_blank" rel="noreferrer">pypi</a></p><p><a href="http://supervisord.org/index.html" target="_blank" rel="noreferrer">官网</a></p><h3 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h3><blockquote><p>安装</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pip</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> supervisor</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># centos</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> supervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> –y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># mac</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> supervisor</span></span></code></pre></div><blockquote><p>配置文件</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>../etc/supervisord.conf (相对于可执行文件)</span></span>
<span class="line"><span>../supervisord.conf (相对于可执行文件)</span></span>
<span class="line"><span>$pwd/supervisord.conf</span></span>
<span class="line"><span>$pwd/etc/supervisord.conf</span></span>
<span class="line"><span>/etc/supervisord.conf</span></span></code></pre></div><h3 id="命令" tabindex="-1">命令 <a class="header-anchor" href="#命令" aria-label="Permalink to &quot;命令&quot;">​</a></h3><ul><li><p>查看所有进程的状态</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span></code></pre></div><blockquote><p>服务名称</p><p>运行状态:RUNNING(运行中),FATAL(运行失败),STARTING(启动中),STOPED(已停止)</p><p>进程号</p><p>已经运行时间</p></blockquote></li><li><p>查看单个任务状态</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">服务名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">称</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></li><li><p>关闭任务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">服务名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">称</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></li><li><p>启动任务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">服务名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">称</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></li><li><p>重启任务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">服务名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">称</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></li><li><p>更新任务</p></li><li><blockquote><p>重新加载 config 并根据需要添加/删除，然后重新启动受影响的程序</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>supervisorctl update &lt;服务名称&gt;</span></span></code></pre></div></li><li><p>获取pid</p><blockquote><p>获取某个任务pid</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>supervisorctl pid &lt;服务名称&gt;</span></span></code></pre></div><blockquote><p>获取所有任务pid</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>supervisorctl pid</span></span></code></pre></div><blockquote><p>获取任务包括子进程pid</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>supervisorctl pid all</span></span></code></pre></div></li><li><p>重载修改、新添加的配置文件</p><blockquote><p>有时候只改动了某个配置文件，只想重载这个配置文件然后重启，不影响其他配置文件</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>supervisorctl update</span></span></code></pre></div><blockquote><p>新添加了一个配置文件，此时update命令没用了，要用reread命令。然后再update重启</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>supervisorctl reread</span></span></code></pre></div></li></ul><h3 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h3><blockquote><p>supervisor.conf</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[unix_http_server]</span></span>
<span class="line"><span>file=/tmp/supervisor.sock   #UNIX socket 文件，supervisorctl 会使用</span></span>
<span class="line"><span>#chmod=0700                 #socket文件的mode，默认是0700</span></span>
<span class="line"><span>#chown=nobody:nogroup       #socket文件的owner，格式：uid:gid</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>#[inet_http_server]         #HTTP服务器，提供web管理界面</span></span>
<span class="line"><span>#port=127.0.0.1:9001        #Web管理后台运行的IP和端口，如果开放到公网，需要注意安全性</span></span>
<span class="line"><span>#username=user              #登录管理后台的用户名</span></span>
<span class="line"><span>#password=123               #登录管理后台的密码</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>[supervisord]</span></span>
<span class="line"><span>logfile=/tmp/supervisord.log #日志文件，默认是 $CWD/supervisord.log</span></span>
<span class="line"><span>logfile_maxbytes=50MB        #日志文件大小，超出会rotate，默认 50MB，如果设成0，表示不限制大小</span></span>
<span class="line"><span>logfile_backups=10           #日志文件保留备份数量默认10，设为0表示不备份</span></span>
<span class="line"><span>loglevel=info                #日志级别，默认info，其它: debug,warn,trace</span></span>
<span class="line"><span>pidfile=/tmp/supervisord.pid #pid 文件</span></span>
<span class="line"><span>nodaemon=false               #是否在前台启动，默认是false，即以 daemon 的方式启动</span></span>
<span class="line"><span>minfds=1024                  #可以打开的文件描述符的最小值，默认 1024</span></span>
<span class="line"><span>minprocs=200                 #可以打开的进程数的最小值，默认 200</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>[supervisorctl]</span></span>
<span class="line"><span>serverurl=unix:///tmp/supervisor.sock #通过UNIX socket连接supervisord，路径与unix_http_server部分的file一致</span></span>
<span class="line"><span>#serverurl=http://127.0.0.1:9001 # 通过HTTP的方式连接supervisord</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>#[program:xx]是被管理的进程配置参数，xx是进程的名称</span></span>
<span class="line"><span>[program:xx]</span></span>
<span class="line"><span>command=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  # 程序启动命令</span></span>
<span class="line"><span>autostart=true       # 在supervisord启动的时候也自动启动</span></span>
<span class="line"><span>startsecs=10         # 启动10秒后没有异常退出，就表示进程正常启动了，默认为1秒</span></span>
<span class="line"><span>autorestart=true     # 程序退出后自动重启,可选值：[unexpected,true,false]，默认为unexpected，表示进程意外杀死后才重启</span></span>
<span class="line"><span>startretries=3       # 启动失败自动重试次数，默认是3</span></span>
<span class="line"><span>user=tomcat          # 用哪个用户启动进程，默认是root</span></span>
<span class="line"><span>priority=999         # 进程启动优先级，默认999，值小的优先启动</span></span>
<span class="line"><span>redirect_stderr=true # 把stderr重定向到stdout，默认false</span></span>
<span class="line"><span>stdout_logfile_maxbytes=20MB  # stdout 日志文件大小，默认50MB</span></span>
<span class="line"><span>stdout_logfile_backups = 20   # stdout 日志文件备份数，默认是10</span></span>
<span class="line"><span># stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）</span></span>
<span class="line"><span>stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out</span></span>
<span class="line"><span>stopasgroup=false     #默认为false,进程被杀死时，是否向这个进程组发送stop信号，包括子进程</span></span>
<span class="line"><span>killasgroup=false     #默认为false，向进程组发送kill信号，包括子进程</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>#包含其它配置文件</span></span>
<span class="line"><span>[include]</span></span>
<span class="line"><span>files = relative/directory/*.ini    #可以指定一个或多个以.ini结束的配置文件</span></span></code></pre></div>`,14)]))}const u=a(e,[["render",l]]);export{k as __pageData,u as default};
