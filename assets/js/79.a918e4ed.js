(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{355:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),t("blockquote",[t("p",[s._v("官网 "),t("a",{attrs:{href:"https://www.elastic.co/guide/en/beats/filebeat/7.12/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Filebeat"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("github "),t("a",{attrs:{href:"https://github.com/elastic/beats",target:"_blank",rel:"noopener noreferrer"}},[s._v("Beats "),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("h4",{attrs:{id:"刷新配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#刷新配置文件"}},[s._v("#")]),s._v(" 刷新配置文件")]),s._v(" "),t("p",[s._v("这些文件包括主配置文件都需要写限"),t("code",[s._v("chmod go+w ...")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("filebeat.config.inputs:\n  enabled: true\t\t\t\t  \n  path: inputs.d/*.yml\t\t# 配置文件地址\n  reload.enabled: true\t\t# 开启刷新配置文件\n  reload.period: 10s\t\t\t# 刷新周期\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"聚合多行日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#聚合多行日志"}},[s._v("#")]),s._v(" 聚合多行日志")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(" multiline:\n   pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'   \t# 指定匹配的表达式（匹配以 2017-11-15）\n   negate: true                                # 是否未匹配到\n   match: after                                # 合并到上一行的末尾, 为了error等日志\n   max_lines: 1000                             # 最大的行数\n   timeout: 30s                                # 如果在规定的时候没有新的日志事件就不等待后面的日志\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"提取参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提取参数"}},[s._v("#")]),s._v(" 提取参数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('processors:\n  - dissect:\n      tokenizer: "%{key1} %{key2} %{key3|convert_datatype}"  \t# 通过正则提取参数\n      field: "message"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# 提取的字段，默认“message”\n      target_prefix: "dissect"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# 输出字段前缀，默认“dissect”\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"收集k8s日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#收集k8s日志"}},[s._v("#")]),s._v(" 收集k8s日志")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('\t\tfilebeat.inputs:\n    - type: container\n      exclude_lines: [\'^DBG\']   #屏蔽空字符串\n      paths:\n        - /var/log/containers/*.log\n      processors:\n        - add_kubernetes_metadata:\n            host: ${NODE_NAME}\n            matchers:\n            - logs_path:\n                logs_path: "/var/log/containers/"\n        # 删除一下乱七八糟的字段\n        - drop_fields:\n            fields: ["container", "ecs","beat","host","input","source","offset"]\n              \n        # 只收集 hillinsight 命名空间下的日志\n        - drop_event:\n              when:\n                not:\n                  contains:\n                    kubernetes.namespace: "hillinsight"\n   \n      multiline:\n          pattern: \'^[0-9]{4}-[0-9]{2}-[0-9]{2}\'   # 指定匹配的表达式（匹配以 2017-11-15）\n          negate: true                                # 是否未匹配到\n          match: after                                # 合并到上一行的末尾, 为了error等日志\n          max_lines: 1000                             # 最大的行数\n          timeout: 30s                                # 如果在规定的时候没有新的日志事件就不等待后面的日志\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);