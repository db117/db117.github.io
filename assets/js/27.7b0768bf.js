(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{304:function(s,n,t){"use strict";t.r(n);var a=t(10),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"json-基本操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#json-基本操作"}},[s._v("#")]),s._v(" JSON 基本操作")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/sql/relational-databases/json/json-data-sql-server?view=sql-server-ver15",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 JSON 数据 - SQL Server | Microsoft Docs"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"将查询结果格式化为-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#将查询结果格式化为-json"}},[s._v("#")]),s._v(" 将查询结果格式化为 JSON")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT name, surname  \nFROM emp  \nFOR JSON AUTO;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"获取-json-数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取-json-数据"}},[s._v("#")]),s._v(" 获取 json 数据")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DECLARE @jsonInfo NVARCHAR(MAX)\n\nSET @jsonInfo=N\'{  \n     "info":{    \n       "type":1,  \n       "address":{    \n         "town":"Bristol",  \n         "county":"Avon",  \n         "country":"England"  \n       },  \n       "tags":["Sport", "Water polo"]  \n    },  \n    "type":"Basic"  \n }\' \n \n // 对于数组\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("获取值 JSON_VALUE")]),s._v(" "),n("blockquote",[n("p",[s._v("从 JSON 字符串中提取标量值。不能获取对象。")]),s._v(" "),n("p",[s._v("JSON_VALUE(<字段或设置的变量>,'"),n("path",[s._v("')")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("json_value(@jsonInfo,'$')\t\t\t\t\t\t\tnull\njson_value(@jsonInfo,'$.info.type')\t\tN'1'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("获取对象 JSON_QUERY")]),s._v(" "),n("blockquote",[n("p",[s._v("从 JSON 字符串中提取对象或数组。不能获取值。")]),s._v(" "),n("p",[s._v("JSON_QUERY(<字段或设置的变量>,'"),n("path",[s._v("')")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("json_query(@jsonInfo,'$.info.type')  \tnull\njson_query(@jsonInfo,'$')\t\t\t\t\t\t\t返回整个 JSON 文本。\njson_query(@jsonInfo,'$.info.tags')  \tN'[ \"Sport\", \"Water polo\"]'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("数组读取")]),s._v(" "),n("blockquote",[n("p",[s._v("对于数组读取，可以使用OPENJSON，或使用 "),n("code",[s._v("$[0].xxx")]),s._v("方式获取")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DECLARE @jsonInfo NVARCHAR(MAX)\n\nSET @jsonInfo=N\'[{  \n     "info":{    \n       "type":1,  \n       "address":{    \n         "town":"Bristol",  \n         "county":"Avon",  \n         "country":"England"  \n       },  \n       "tags":["Sport", "Water polo"]  \n    },  \n    "type":"Basic"  \n }]\' \n \njson_value(@jsonInfo,\'$[0].info.type\')\t\tN\'1\'\njson_query(@jsonInfo,\'$[0].info.tags\')  \tN\'[ "Sport", "Water polo"]\'\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("OPENJSON")]),s._v(" "),n("blockquote",[n("p",[s._v("对 JSON 文档提供行集视图。")]),s._v(" "),n("p",[s._v("OPENJSON( jsonExpression [ , path ] )  [ <with_clause> ] <with_clause> ::= WITH ( { colName type [ column_path ] [ AS JSON ] } [ ,...n ] )")])]),s._v(" "),n("p",[s._v("解析默认为 "),n("code",[s._v("key")]),s._v(","),n("code",[s._v("value")]),s._v(","),n("code",[s._v("type")]),s._v("三个属性，下面为 type 的含义。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[s._v("类型列的值")]),s._v(" "),n("th",{staticStyle:{"text-align":"left"}},[s._v("JSON 数据类型")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("0")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("Null")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("1")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("字符串")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("2")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("数字")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("3")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("true/false")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("4")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("array")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("5")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("对象 (object)")])])])]),s._v(" "),n("p",[s._v("可以使用 "),n("code",[s._v("with")]),s._v("指定返回的行集头")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DECLARE @array VARCHAR(MAX);\nSET @array = \'[{"month":"Jan", "temp":10},{"month":"Feb", "temp":12},{"month":"Mar", "temp":15},\n               {"month":"Apr", "temp":17},{"month":"May", "temp":23},{"month":"Jun", "temp":27}\n              ]\';\n\nSELECT * FROM OPENJSON(@array)\n        WITH (  month VARCHAR(3),\n                temp int)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"修改-json-的值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改-json-的值"}},[s._v("#")]),s._v(" 修改 json 的值")]),s._v(" "),n("blockquote",[n("p",[s._v("JSON_MODIFY ( expression , path , newValue )")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DECLARE @info NVARCHAR(100)=\'{"name":"John","skills":["C#","SQL"]}\'\n\n-- 修改字段\nSET @info=JSON_MODIFY(@info,\'$.name\',\'Mike\')\n{\n    "name": "Mike",\n    "skills": ["C#", "SQL"]\n}\n\n-- 添加字段\nSET @info=JSON_MODIFY(@info,\'$.surname\',\'Smith\')\n{\n    "name": "Mike",\n    "skills": ["C#", "SQL"],\n    "surname": "Smith"\n}\n\n-- 设置字段为 null\nSET @info=JSON_MODIFY(@info,\'strict $.name\',NULL)\n-- 删除字段\nSET @info=JSON_MODIFY(@info,\'$.name\',NULL)\n{\n    "skills": ["C#", "SQL"],\n    "surname": "Smith"\n}\n\n-- 追加数据\nSET @info=JSON_MODIFY(@info,\'append $.skills\',\'Azure\')\n{\n    "skills": ["C#", "SQL", "Azure"],\n    "surname": "Smith"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);