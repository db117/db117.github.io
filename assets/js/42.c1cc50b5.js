(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{428:function(e,t,a){"use strict";a.r(t);var r=a(31),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("blockquote",[a("p",[e._v("基于spring-webflux，netty，springCloud的一个反应式网关。")])]),e._v(" "),a("iframe",{staticStyle:{display:"block",width:"725px",height:"245px"},attrs:{id:"embed_dom",name:"embed_dom",frameborder:"0",src:"https://www.processon.com/embed/616fc00e1efad42eb5ebffb5"}}),e._v(" "),a("h3",{attrs:{id:"基础组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础组件"}},[e._v("#")]),e._v(" 基础组件")]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("route")])]),e._v(" "),a("p",[e._v("由一个id，一个目标URL，一组谓词（"),a("strong",[e._v("Predicate")]),e._v("），和一组过滤器（"),a("strong",[e._v("Filter")]),e._v("）组成")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("org.springframework.cloud.gateway.route.Route\n  private final String id;\n\n\tprivate final URI uri;\n\n\tprivate final int order;\n\n\tprivate final AsyncPredicate<ServerWebExchange> predicate;\n\n\tprivate final List<GatewayFilter> gatewayFilters;\n\n\tprivate final Map<String, Object> metadata;\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Predicate")])]),e._v(" "),a("p",[e._v("继承与"),a("code",[e._v("java.util.function.Predicate")]),e._v("，入参为 "),a("code",[e._v("org.springframework.web.server.ServerWebExchange")]),e._v("，通过 "),a("code",[e._v("test（）")]),e._v("方法判断是否匹配")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("public interface GatewayPredicate extends Predicate<ServerWebExchange>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Filter")])]),e._v(" "),a("p",[e._v("形成过滤器调用链，处理请求值，返回值。")])])]),e._v(" "),a("h3",{attrs:{id:"默认配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认配置"}},[e._v("#")]),e._v(" 默认配置")]),e._v(" "),a("blockquote",[a("p",[e._v("介绍一下主要的配置信息 "),a("code",[e._v("org.springframework.cloud.gateway.config.GatewayAutoConfiguration")])])]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("CompositeRouteDefinitionLocator")])]),e._v(" "),a("p",[e._v("一个"),a("code",[e._v("org.springframework.cloud.gateway.route.RouteDefinitionLocator")]),e._v("合集，主要获取route。集成了一下几个")]),e._v(" "),a("ul",[a("li",[e._v("CachingRouteDefinitionLocator：缓存如有信息")]),e._v(" "),a("li",[e._v("DiscoveryClientRouteDefinitionLocator：通过服务发现加载路由")]),e._v(" "),a("li",[e._v("InMemoryRouteDefinitionRepository：通过api管理的路由信息")]),e._v(" "),a("li",[e._v("PropertiesRouteDefinitionLocator：配置文件的路由信息")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("CachingRouteLocator")])]),e._v(" "),a("p",[e._v("获取所有"),a("code",[e._v("RouteLocator")]),e._v("，通过"),a("code",[e._v("RouteDefinitionLocator")]),e._v("获取路由配置信息，生成路由并缓存。")]),e._v(" "),a("p",[e._v("发生"),a("code",[e._v("RefreshRoutesEvent")]),e._v("事件时刷新缓存")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("RouteRefreshListener")])]),e._v(" "),a("p",[e._v("监听"),a("code",[e._v("ContextRefreshedEvent")]),e._v("，"),a("code",[e._v("RefreshScopeRefreshedEvent")]),e._v("，"),a("code",[e._v("InstanceRegisteredEvent")]),e._v("，"),a("code",[e._v("ParentHeartbeatEvent")]),e._v("，"),a("code",[e._v("HeartbeatEvent")]),e._v("等事件。发送"),a("code",[e._v("RefreshRoutesEvent")]),e._v("事件。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("FilteringWebHandler")])]),e._v(" "),a("p",[e._v("Gateway入口，由webflux核心"),a("code",[e._v("DispatcherHandler")]),e._v("调用，主要工作就是把GlobalFilter通过"),a("code",[e._v("GatewayFilterAdapter")]),e._v("适配成"),a("code",[e._v("GatewayFilter")]),e._v("并生成调用链"),a("code",[e._v("org.springframework.cloud.gateway.handler.FilteringWebHandler.DefaultGatewayFilterChain")]),e._v("。")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("RoutePredicateHandlerMapping")])]),e._v(" "),a("p",[e._v("主要负责找到执行的路由，通过调用路由的"),a("code",[e._v("AsyncPredicate")]),e._v("判断。")])]),e._v(" "),a("li",[a("p",[e._v("GatewayProperties")]),e._v(" "),a("p",[e._v("就是配置文件的东西")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);